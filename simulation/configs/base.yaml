# =============================================================================
# LPWAN Protocol Simulator - Base Configuration
# Novel MQTT-like Protocol for LPWAN (LoRaWAN, NB-IoT, Sigfox)
# =============================================================================

# Simulation parameters
simulation:
  seed: 42
  duration_hours: 24          # Total simulation time
  warmup_hours: 1             # Warmup period (excluded from metrics)
  time_step_ms: 100           # Simulation time granularity

# Network topology
network:
  type: "lorawan"             # lorawan | nbiot | sigfox
  num_devices: 100            # Number of end devices
  num_gateways: 1             # Number of gateways
  
  # LoRaWAN specific
  lorawan:
    region: "EU868"
    duty_cycle: 0.01          # 1% duty cycle
    spreading_factors: [7, 8, 9, 10, 11, 12]
    rx1_delay_ms: 1000
    rx2_delay_ms: 2000
    
  # NB-IoT specific  
  nbiot:
    carrier_freq_mhz: 900
    ue_category: "cat-nb1"
    psm_enabled: true         # Power Saving Mode
    edrx_cycle_s: 20.48       # Extended DRX

# Protocol comparison settings
protocols:
  # Novel protocol (our contribution)
  novel_lpwan:
    enabled: true
    token_size_bytes: 12      # Micro-session token size
    header_size_bytes: 5      # Fixed header size
    
    # Windowed Bitmap ACK
    ack_window_size: 16       # Bits in bitmap
    ack_base_bits: 16         # Bits for ack_base_u
    
    # QoS-D (Deadline + Probability)
    qos_classes:
      - name: "critical"
        probability: 0.99
        deadline_s: 600       # 10 minutes
        retries: 3
      - name: "normal"
        probability: 0.90
        deadline_s: 3600      # 1 hour
        retries: 2
      - name: "best_effort"
        probability: 0.50
        deadline_s: 86400     # 1 day
        retries: 0
        
    # Epoch-based commanding
    epoch_bits: 8
    cmd_types: 8              # Max command types
    
  # MQTT-SN baseline
  mqtt_sn:
    enabled: true
    qos_levels: [0, 1, 2, -1]
    keep_alive_s: 60
    topic_id_type: "predefined"  # predefined | short | normal
    
  # CoAP baseline
  coap:
    enabled: true
    confirmable_ratio: 0.5    # Ratio of CON vs NON messages
    max_retransmit: 4
    ack_timeout_s: 2
    
# Traffic patterns
traffic:
  # Uplink telemetry
  uplink:
    pattern: "periodic"       # periodic | poisson | event_driven
    interval_s: 600           # Mean interval (10 minutes)
    payload_bytes: 20         # Average payload size
    jitter_ratio: 0.1         # Â±10% jitter
    
  # Downlink commands (C&C)
  downlink:
    pattern: "bursty"         # uniform | bursty | scheduled
    mean_rate_per_hour: 2     # Commands per device per hour
    payload_bytes: 10
    priority_distribution:
      critical: 0.05
      normal: 0.25
      best_effort: 0.70
      
  # Command Pull (novel protocol)
  command_pull:
    enabled: true
    budget_default: 3         # Default cmd_budget per pull
    
# Device model
device:
  # Power consumption (mW)
  power:
    sleep: 0.001              # Deep sleep
    idle: 1.0                 # MCU idle
    rx: 12.0                  # Radio receive
    tx_dbm_to_mw:             # TX power mapping
      2: 25
      8: 40
      14: 80
      20: 120
      
  # Memory constraints
  memory:
    ram_bytes: 8192           # Available RAM
    flash_bytes: 65536        # Available flash
    
  # Protocol stack footprint
  stack_overhead:
    novel_lpwan_ram: 32       # Our protocol: ~32 bytes state
    mqtt_sn_ram: 256          # MQTT-SN: connection state
    coap_ram: 128             # CoAP: transaction state

# Gateway model
gateway:
  # Queue management
  queue_size: 1000            # Max pending commands
  scheduler: "priority_deadline"  # fifo | priority | priority_deadline
  
  # MQTT bridge
  mqtt_bridge:
    enabled: true
    broker_host: "localhost"
    broker_port: 1883
    qos_mapping:
      critical: 1
      normal: 1
      best_effort: 0

# Metrics collection
metrics:
  collect_interval_s: 60
  output_format: "csv"        # csv | json | parquet
  
  # Metrics to collect
  enabled:
    - "delivery_rate"
    - "delivery_latency"
    - "energy_per_message"
    - "airtime_usage"
    - "downlink_efficiency"
    - "state_memory"
    - "retransmission_rate"
    - "qos_deadline_compliance"
